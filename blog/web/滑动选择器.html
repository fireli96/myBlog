<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>滑动选择器 | Spark</title>
    <meta name="generator" content="VuePress 1.5.2">
    <script src="https://cdn.jsdelivr.net/gh/sparklinm/js-library/d/bundle.umd.js"></script>
    <link rel="icon" href="/logo.png">
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@11.0.0/dist/markdown-it.js"></script>
    <meta name="description" content="Just playing around">
    <meta title="滑动选择器" time="2020-03-18T10:14:21.000Z" tag="js">
    <link rel="preload" href="/assets/css/0.styles.0c2811eb.css" as="style"><link rel="preload" href="/assets/js/app.61190595.js" as="script"><link rel="preload" href="/assets/js/36.0c59cfbe.js" as="script"><link rel="prefetch" href="/assets/js/10.2414efa1.js"><link rel="prefetch" href="/assets/js/11.06130b25.js"><link rel="prefetch" href="/assets/js/12.33bbb473.js"><link rel="prefetch" href="/assets/js/13.b1db4ecb.js"><link rel="prefetch" href="/assets/js/14.f777e5f5.js"><link rel="prefetch" href="/assets/js/15.25bcc4f3.js"><link rel="prefetch" href="/assets/js/16.96bc9df6.js"><link rel="prefetch" href="/assets/js/17.b28d9c78.js"><link rel="prefetch" href="/assets/js/18.b0cb2472.js"><link rel="prefetch" href="/assets/js/19.5236e7cb.js"><link rel="prefetch" href="/assets/js/20.9b39d48b.js"><link rel="prefetch" href="/assets/js/21.413d7e5c.js"><link rel="prefetch" href="/assets/js/22.9b4b5648.js"><link rel="prefetch" href="/assets/js/23.429db586.js"><link rel="prefetch" href="/assets/js/24.a4b2bf53.js"><link rel="prefetch" href="/assets/js/25.da7f6f44.js"><link rel="prefetch" href="/assets/js/26.1c86c8c4.js"><link rel="prefetch" href="/assets/js/27.567853cd.js"><link rel="prefetch" href="/assets/js/28.e79e9272.js"><link rel="prefetch" href="/assets/js/29.4c76ffad.js"><link rel="prefetch" href="/assets/js/3.ff140cd7.js"><link rel="prefetch" href="/assets/js/30.024d7314.js"><link rel="prefetch" href="/assets/js/31.33031f17.js"><link rel="prefetch" href="/assets/js/32.6e130523.js"><link rel="prefetch" href="/assets/js/33.58b44621.js"><link rel="prefetch" href="/assets/js/34.7400e94e.js"><link rel="prefetch" href="/assets/js/35.f2767470.js"><link rel="prefetch" href="/assets/js/37.d2c43d60.js"><link rel="prefetch" href="/assets/js/38.27af19fa.js"><link rel="prefetch" href="/assets/js/39.80642131.js"><link rel="prefetch" href="/assets/js/4.754dfb46.js"><link rel="prefetch" href="/assets/js/40.08f6c317.js"><link rel="prefetch" href="/assets/js/41.1f789247.js"><link rel="prefetch" href="/assets/js/42.22aa889a.js"><link rel="prefetch" href="/assets/js/43.ce3ab661.js"><link rel="prefetch" href="/assets/js/44.1a0e84c4.js"><link rel="prefetch" href="/assets/js/45.362e5ef5.js"><link rel="prefetch" href="/assets/js/46.4d738550.js"><link rel="prefetch" href="/assets/js/47.07a89f4e.js"><link rel="prefetch" href="/assets/js/48.c5699e18.js"><link rel="prefetch" href="/assets/js/49.7cdcb266.js"><link rel="prefetch" href="/assets/js/5.9db707e5.js"><link rel="prefetch" href="/assets/js/50.caaed377.js"><link rel="prefetch" href="/assets/js/51.c8eb298c.js"><link rel="prefetch" href="/assets/js/52.97badafd.js"><link rel="prefetch" href="/assets/js/53.7a9e10fc.js"><link rel="prefetch" href="/assets/js/54.273c8ea9.js"><link rel="prefetch" href="/assets/js/6.a3a6a4b1.js"><link rel="prefetch" href="/assets/js/7.ec11f840.js"><link rel="prefetch" href="/assets/js/8.86b5445f.js"><link rel="prefetch" href="/assets/js/9.c2af3ea8.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.46847213.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0c2811eb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><div class="navbar-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Spark" class="logo"> <span class="site-name can-hide">Spark</span></a> <div class="links" style="max-width:nullpx;"><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link">
  Web开发
</a></div><div class="nav-item"><a href="/tool/" class="nav-link">
  工具使用
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  微代码
</a></div><div class="nav-item"><a href="/tag/" class="nav-link">
  云标签
</a></div> <!----></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></header></div> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link">
  Web开发
</a></div><div class="nav-item"><a href="/tool/" class="nav-link">
  工具使用
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  微代码
</a></div><div class="nav-item"><a href="/tag/" class="nav-link">
  云标签
</a></div> <!----></nav>  <ul class="sidebar-links"><li><div depth="0" class="sidebar-group"><p class="sidebar-heading open"><span>滑动选择器</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#前言" class="sidebar-link">前言</a></li><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#如何滑动" class="sidebar-link">如何滑动</a></li><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#添加选择框" class="sidebar-link">添加选择框</a></li><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#添加事件" class="sidebar-link">添加事件</a></li><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#修正位置" class="sidebar-link">修正位置</a></li><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#类的方式实现" class="sidebar-link">类的方式实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#dom-结构" class="sidebar-link">dom 结构</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#事件控制" class="sidebar-link">事件控制</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#配置选项" class="sidebar-link">配置选项</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#获取列表元素信息" class="sidebar-link">获取列表元素信息</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#选择框" class="sidebar-link">选择框</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#获取元素位置和索引" class="sidebar-link">获取元素位置和索引</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#滑动" class="sidebar-link">滑动</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#源码" class="sidebar-link">源码</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="article-list-inner" style="display:none;"><div class="tag-container"><div class="tag-item-container" style="display:none;"><span class="tag">
        eslint
      </span><span class="tag">
        工具使用
      </span><span class="tag">
        VuePress
      </span><span class="tag">
        babel
      </span><span class="tag">
        总结
      </span><span class="tag">
        jsdoc
      </span><span class="tag">
        环境搭建
      </span><span class="tag">
        rollup
      </span><span class="tag">
        收藏
      </span><span class="tag">
        html
      </span><span class="tag">
        图片下载
      </span><span class="tag">
        canvas
      </span><span class="tag">
        布局
      </span><span class="tag">
        js
      </span><span class="tag">
        模块
      </span><span class="tag">
        vue
      </span><span class="tag">
        echart
      </span><span class="tag">
        moment
      </span><span class="tag">
        拖拽
      </span><span class="tag">
        css
      </span><span class="tag">
        组件
      </span><span class="tag">
        文档
      </span><span class="tag">
        websocket
      </span><span class="tag">
        socket.io
      </span><span class="tag">
        移动端
      </span></div> <div class="tag-tip" style="display:none;">
      标签为
      <span></span>下的文章
    </div></div> <div></div></div> <div class="content__default"><h1 id="滑动选择器"><a href="#滑动选择器" class="header-anchor">#</a> 滑动选择器</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>要实现如以下的选择器，可以上下滑动，获取选择的值。</p> <p><img src="https://fireli-1256465711.cos.ap-chengdu.myqcloud.com/img/1584845677570.png" alt=""></p> <h2 id="如何滑动"><a href="#如何滑动" class="header-anchor">#</a> 如何滑动</h2> <p>最简单的方式就是将<code>列表</code>设置为超出隐藏，然后改变列表的<code>translateY</code>的值。</p> <h2 id="添加选择框"><a href="#添加选择框" class="header-anchor">#</a> 添加选择框</h2> <p><code>选择框</code> 是和<code>列表元素</code>同样大小，并且和列表同级，以<code>绝对定位</code>固定位置。如果是处于列表里面，因为列表是通过改变<code>translateY</code>滑动的，而<code>translateY</code>会影响<code>绝对定位</code>，那选择框的位置不可控。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list-contianer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 选择框和列表同级 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-select-box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>设置<code>slide-list-contianer</code>固定高度，和超出隐藏。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.slide-list-contianer</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 160px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 160px<span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.slide-list li</span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>选择框和列表同级。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.slide-list-contianer</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 160px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 64px<span class="token punctuation">;</span>
  <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid <span class="token function">rgb</span><span class="token punctuation">(</span>3<span class="token punctuation">,</span> 136<span class="token punctuation">,</span> 189<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid <span class="token function">rgb</span><span class="token punctuation">(</span>3<span class="token punctuation">,</span> 136<span class="token punctuation">,</span> 189<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>169<span class="token punctuation">,</span> 221<span class="token punctuation">,</span> 241<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0.4<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="添加事件"><a href="#添加事件" class="header-anchor">#</a> 添加事件</h2> <p>需要保证在选择框上滑动时，列表也会改变。所以只能在 <code>slide-list-contianer</code>上监听滑动事件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.slide-list-contianer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchstart&quot;</span><span class="token punctuation">,</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchmove&quot;</span><span class="token punctuation">,</span> move<span class="token punctuation">)</span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchend&quot;</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="修正位置"><a href="#修正位置" class="header-anchor">#</a> 修正位置</h2> <p>在滑动事件结束时（例如：<code>touchend</code>），可能 <code>选择框</code> 并不完全处于对应元素上：</p> <p><img src="https://fireli-1256465711.cos.ap-chengdu.myqcloud.com/img/1584845677572.png" alt=""></p> <p>需要在结束后，自动移动到最近的元素上。离选择框最近的元素也就是离顶线最近的元素。</p> <p>因为列表元素的高度是统一的，那么每个列表元素的位置也是固定的，假设元素的索引为<code>index</code>，单个元素的高度为<code>height</code>，列表的偏移距离为<code>translateY</code>，那么可以得到：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 离顶线最近元素</span>
<span class="token keyword">let</span> correctIndex <span class="token operator">=</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>translateY <span class="token operator">/</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 元素位置</span>
<span class="token keyword">let</span> correctTranslateY <span class="token operator">=</span> <span class="token operator">-</span>correctIndex <span class="token operator">*</span> height<span class="token punctuation">;</span>
</code></pre></div><p>然后改变<code>translateY</code>的值为<code>correctTranslateY</code>。</p> <p>注意，需要判断边界值，即边界情况为<code>最上面/最下面</code>元素处于选择框。</p> <h2 id="类的方式实现"><a href="#类的方式实现" class="header-anchor">#</a> 类的方式实现</h2> <h3 id="dom-结构"><a href="#dom-结构" class="header-anchor">#</a> dom 结构</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list-contianer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 如果没有，就是默认选择框 --&gt;</span>
  <span class="token comment">&lt;!-- &lt;div class=&quot;slide-select-box&quot;&gt;&lt;/div&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="事件控制"><a href="#事件控制" class="header-anchor">#</a> 事件控制</h3> <p>自定义事件控制器。</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// on 监听的事件</span>
  onEvents <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// once:表示注册的事件只执行一次便自动移除</span>
  <span class="token function">on</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> once <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> name<span class="token punctuation">,</span>
      callback<span class="token operator">:</span> callback<span class="token punctuation">,</span>
      once<span class="token operator">:</span> once
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 移除事件</span>
  <span class="token function">off</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> event<span class="token punctuation">.</span>callback <span class="token operator">!==</span> callback
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">emit</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      event<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token operator">...</span>params<span class="token punctuation">)</span>
      <span class="token comment">// 事件执行完毕后，判断是否为一次性事件</span>
      <span class="token keyword">return</span> <span class="token operator">!</span>event<span class="token punctuation">.</span>once
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="配置选项"><a href="#配置选项" class="header-anchor">#</a> 配置选项</h3> <p>根据配置选项，将列表初始化为一个选择器。选项如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 可见行数</span>
  visiableRowCount<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token comment">// 初始位置索引</span>
  startIndex<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">// 保持索引位置不变</span>
  keepIndex<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 选择框</span>
  selectBox<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 选择框所在位置</span>
    position<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    style<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>详细阐述如图：</p> <p><img src="https://fireli-1256465711.cos.ap-chengdu.myqcloud.com/img/1584845677573.png" alt="enter description here"></p> <ul><li><code>visiableRowCount</code>：可见行数，超出的通过滑动出现。这里为 5。</li> <li><code>startIndex</code>：开始索引，最开始选择的元素索引。这里选择的是 2 号元素，<code>startIndex</code>为 2。</li> <li><code>keepIndex</code>：如果多次初始化选择器（执行<code>init</code>函数），保证所选元素索引不变。</li> <li><code>selectBox</code>: 选择框的配置
<ul><li><code>position</code>：选择框的位置，这里在第 2 号位置。</li> <li><code>style</code>：默认选择框的样式。</li></ul></li></ul> <h3 id="获取列表元素信息"><a href="#获取列表元素信息" class="header-anchor">#</a> 获取列表元素信息</h3> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">setNodes</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.slide-list'</span><span class="token punctuation">)</span>

    <span class="token comment">// 每个元素大小相同</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// offsetWidth在元素隐藏时无效</span>
      width<span class="token operator">:</span> list<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>offsetWidth <span class="token operator">||</span> <span class="token number">30</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> list<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>offsetHeight <span class="token operator">||</span> <span class="token number">30</span><span class="token punctuation">,</span>
      total<span class="token operator">:</span> list<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list
    <span class="token keyword">this</span><span class="token punctuation">.</span>nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span>children<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="选择框"><a href="#选择框" class="header-anchor">#</a> 选择框</h3> <p>可以自定义选择框，通过添加一个类为<code>slide-select-box</code>的元素。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list-contianer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 如果没有，就是默认选择框 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-select-box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果没有则会启用默认选择框，可以在配置选项中更改默认选择框样式。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">addSelectBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 添加前，如果存在先remove掉</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectBox<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectBox<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo<span class="token punctuation">.</span>height
    <span class="token keyword">const</span> customSelectBox <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.slide-select-box'</span><span class="token punctuation">)</span>

    <span class="token comment">// 相对于父元素定位</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'relative'</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>customSelectBox<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      customSelectBox<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token comment">// 不改变原dom</span>
      <span class="token keyword">const</span> copy <span class="token operator">=</span> customSelectBox<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span>
      <span class="token comment">// 隐藏原dom</span>
      customSelectBox<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
      <span class="token keyword">const</span> computedStyle <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span>
        copy<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          top<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position <span class="token operator">*</span> height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
          position<span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
          width<span class="token operator">:</span> computedStyle<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
          height<span class="token operator">:</span> computedStyle<span class="token punctuation">.</span>height
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>selectBox <span class="token operator">=</span> copy
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 默认选择框</span>
    <span class="token keyword">const</span> selectBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span>selectBox<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      width<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span>offsetWidth <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
      position<span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
      left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      top<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position <span class="token operator">*</span> height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
      borderTop<span class="token operator">:</span> <span class="token string">'1px solid rgb(3, 136, 189)'</span><span class="token punctuation">,</span>
      borderBottom<span class="token operator">:</span> <span class="token string">'1px solid rgb(3, 136, 189)'</span><span class="token punctuation">,</span>
      background<span class="token operator">:</span> <span class="token string">'rgb(169, 221, 241)'</span><span class="token punctuation">,</span>
      opacity<span class="token operator">:</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>style
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>selectBox<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>selectBox <span class="token operator">=</span> selectBox
<span class="token punctuation">}</span>
</code></pre></div><h3 id="获取元素位置和索引"><a href="#获取元素位置和索引" class="header-anchor">#</a> 获取元素位置和索引</h3> <p>在修正位置或是获取当前选择的的元素等情况下，需要用到以下方法。</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 获取正确的元素位置</span>
  <span class="token function">getCorrectPos</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> correctIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTopIndex</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>translateY<span class="token punctuation">)</span>
    <span class="token keyword">const</span> correctTranslateY <span class="token operator">=</span> <span class="token operator">-</span>correctIndex <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo<span class="token punctuation">.</span>height

    <span class="token keyword">return</span> correctTranslateY
  <span class="token punctuation">}</span>

  <span class="token comment">// 根据translateY获得最近顶部元素索引</span>
  <span class="token function">getTopIndex</span> <span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> topIndex <span class="token operator">=</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>y <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
    <span class="token comment">// 顶端元素在选择框内时，无法再下滑动</span>
    <span class="token keyword">const</span> minTopIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position
    <span class="token keyword">const</span> maxTopIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo<span class="token punctuation">.</span>total <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position

    <span class="token keyword">if</span> <span class="token punctuation">(</span>topIndex <span class="token operator">&lt;</span> minTopIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      topIndex <span class="token operator">=</span> minTopIndex
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>topIndex <span class="token operator">&gt;</span> maxTopIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      topIndex <span class="token operator">=</span> maxTopIndex
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> topIndex
  <span class="token punctuation">}</span>

  <span class="token comment">// 根据translateY获取所选元素索引</span>
  <span class="token function">getSelectedIndex</span> <span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTopIndex</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position
  <span class="token punctuation">}</span>

  <span class="token comment">// 获取所选元素位置</span>
  <span class="token function">getSelectedPos</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">-</span>index <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo<span class="token punctuation">.</span>height
  <span class="token punctuation">}</span>

</code></pre></div><h3 id="滑动"><a href="#滑动" class="header-anchor">#</a> 滑动</h3> <p>滑动就是不断设置元素<code>translateY</code>值。</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">setPos</span> <span class="token punctuation">(</span><span class="token parameter">dy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>translateY <span class="token operator">+=</span> dy
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      transform<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>translateY<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 在滑动过程中实时获得下一个元素索引</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCurIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>
      <span class="token string">'slide'</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>nodes
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">setCurIndex</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>curIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSelectedIndex</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>translateY<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastIndex <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addSelectedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>
        <span class="token string">'change'</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nodes
      <span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>curIndex
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">addSelectedClass</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> curItem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">]</span>
    <span class="token keyword">const</span> lastItem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastIndex<span class="token punctuation">]</span>

    curItem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'slide-item-checked'</span><span class="token punctuation">)</span>
    lastItem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'slide-item-checked'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>在滑动过程中，需要设置当前所选元素索引，分发<code>slide</code>和<code>change</code>事件，并为所选元素添加<code>slide-item-checked</code>事件。</p> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.slide-list-contianer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> slide <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Slide</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// 可见行数</span>
  visiableRowCount<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token comment">// 初始位置索引</span>
  startIndex<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">// 保持索引位置不变</span>
  keepIndex<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 选择框</span>
  selectBox<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 选择框所在位置</span>
    position<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    style<span class="token operator">:</span> <span class="token punctuation">{</span>
      background<span class="token operator">:</span> <span class="token string">&quot;red&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slide<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> nodes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slide<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="源码"><a href="#源码" class="header-anchor">#</a> 源码</h3> <p>源码和更多使用请看：</p></div> <div class="sidebar-right"><div class="sidebar-right-inner"><div class="newest"><div class="title">
          推荐阅读
        </div> <ol class="title-list"></ol></div> <div class="about"><div class="title">
          云标签
        </div> <div class="title-list"><span class="tag">
            eslint
          </span><span class="tag">
            工具使用
          </span><span class="tag">
            VuePress
          </span><span class="tag">
            babel
          </span><span class="tag">
            总结
          </span><span class="tag">
            jsdoc
          </span><span class="tag">
            环境搭建
          </span><span class="tag">
            rollup
          </span><span class="tag">
            收藏
          </span><span class="tag">
            html
          </span><span class="tag">
            图片下载
          </span><span class="tag">
            canvas
          </span><span class="tag">
            布局
          </span><span class="tag">
            js
          </span><span class="tag">
            模块
          </span><span class="tag">
            vue
          </span><span class="tag">
            echart
          </span><span class="tag">
            moment
          </span><span class="tag">
            拖拽
          </span><span class="tag">
            css
          </span><span class="tag">
            组件
          </span><span class="tag">
            文档
          </span><span class="tag">
            websocket
          </span><span class="tag">
            socket.io
          </span><span class="tag">
            移动端
          </span></div></div> <div class="catalog"><div class="title">
          目录
        </div> <ul class="sidebar-links"><li><div depth="0" class="sidebar-group"><p class="sidebar-heading open"><span>滑动选择器</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#前言" class="sidebar-link">前言</a></li><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#如何滑动" class="sidebar-link">如何滑动</a></li><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#添加选择框" class="sidebar-link">添加选择框</a></li><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#添加事件" class="sidebar-link">添加事件</a></li><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#修正位置" class="sidebar-link">修正位置</a></li><li><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#类的方式实现" class="sidebar-link">类的方式实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#dom-结构" class="sidebar-link">dom 结构</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#事件控制" class="sidebar-link">事件控制</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#配置选项" class="sidebar-link">配置选项</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#获取列表元素信息" class="sidebar-link">获取列表元素信息</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#选择框" class="sidebar-link">选择框</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#获取元素位置和索引" class="sidebar-link">获取元素位置和索引</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#滑动" class="sidebar-link">滑动</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#源码" class="sidebar-link">源码</a></li></ul></li></ul></div></li></ul></div></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/27/2020, 10:10:44 PM</span></div></div> <!----> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.61190595.js" defer></script><script src="/assets/js/36.0c59cfbe.js" defer></script>

    <div class="cm-enter-loading">
      <div class="cm-spinner-box">
        <div class="cm-configure-border-1">
          <div class="cm-configure-core"></div>
        </div>
        <div class="cm-configure-border-2">
          <div class="cm-configure-core"></div>
        </div>
        <p class="cm-loading-text">loading...</p>
      </div>
    </div>

    <style>
      .cm-enter-loading {
        position: fixed;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        background-color: #37474f;
        z-index: 10000;
      }

      .cm-spinner-box {
        display: inline-block;
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }
      .cm-configure-border-1 {
        width: 115px;
        height: 115px;
        padding: 3px;
        position: absolute;
        background: #ffab91;
        animation: configure-clockwise 3s ease-in-out 0s infinite alternate;
      }

      .cm-configure-border-2 {
        width: 115px;
        height: 115px;
        padding: 3px;
        left: -115px;
        background: rgb(63, 249, 220);
        transform: rotate(45deg);
        animation: configure-xclockwise 3s ease-in-out 0s infinite alternate;
      }

      .cm-configure-core {
        width: 100%;
        height: 100%;
        background-color: #37474f;
      }

      .cm-loading-text {
        font-size: 40px;
        color: white;
        font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif
      }

      @keyframes configure-clockwise {
        0% {
          transform: rotate(0);
        }
        25% {
          transform: rotate(90deg);
        }
        50% {
          transform: rotate(180deg);
        }
        75% {
          transform: rotate(270deg);
        }
        100% {
          transform: rotate(359deg);
        }
      }

      @keyframes configure-xclockwise {
        0% {
          transform: rotate(45deg);
        }
        25% {
          transform: rotate(-45deg);
        }
        50% {
          transform: rotate(-135deg);
        }
        75% {
          transform: rotate(-215deg);
        }
        100% {
          transform: rotate(-305deg);
        }
      }
    </style>

  </body>
</html>