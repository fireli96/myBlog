<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>滑动选择器 | My Blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Just playing around">
    <meta title="滑动选择器" time="2020-03-18T10:14:21.000Z" tag="js">
    <link rel="preload" href="/vuepress-blog/assets/css/0.styles.8d2271d8.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.f68b45ad.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/24.502f4dcd.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/10.cd0755f3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/11.49ba89e8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/12.d53527b3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/13.9a5a6123.js"><link rel="prefetch" href="/vuepress-blog/assets/js/14.c736d971.js"><link rel="prefetch" href="/vuepress-blog/assets/js/15.ac0bc7a2.js"><link rel="prefetch" href="/vuepress-blog/assets/js/16.a79dc650.js"><link rel="prefetch" href="/vuepress-blog/assets/js/17.58fdfd58.js"><link rel="prefetch" href="/vuepress-blog/assets/js/18.eff555db.js"><link rel="prefetch" href="/vuepress-blog/assets/js/19.96306d3f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/20.36420206.js"><link rel="prefetch" href="/vuepress-blog/assets/js/21.63b8c791.js"><link rel="prefetch" href="/vuepress-blog/assets/js/22.422cb36a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/23.0d115c0c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/25.26cdb6ff.js"><link rel="prefetch" href="/vuepress-blog/assets/js/26.3b9288d5.js"><link rel="prefetch" href="/vuepress-blog/assets/js/27.750cdd9d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/28.97fe86f3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/29.58cd2aab.js"><link rel="prefetch" href="/vuepress-blog/assets/js/3.fa1f8969.js"><link rel="prefetch" href="/vuepress-blog/assets/js/30.2f2405fa.js"><link rel="prefetch" href="/vuepress-blog/assets/js/31.c910ab09.js"><link rel="prefetch" href="/vuepress-blog/assets/js/32.b955feb4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/33.bca92fd9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/34.10340bea.js"><link rel="prefetch" href="/vuepress-blog/assets/js/35.93afbc63.js"><link rel="prefetch" href="/vuepress-blog/assets/js/36.0b90d1cf.js"><link rel="prefetch" href="/vuepress-blog/assets/js/37.999cd3fe.js"><link rel="prefetch" href="/vuepress-blog/assets/js/38.52912422.js"><link rel="prefetch" href="/vuepress-blog/assets/js/39.3accaf95.js"><link rel="prefetch" href="/vuepress-blog/assets/js/4.e04ab1a0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/40.72eb121e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/41.201c06fc.js"><link rel="prefetch" href="/vuepress-blog/assets/js/42.739f889f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/43.2c074a53.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.df348cc3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.c14aff83.js"><link rel="prefetch" href="/vuepress-blog/assets/js/7.22ae6ee6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/8.93a1ce12.js"><link rel="prefetch" href="/vuepress-blog/assets/js/9.5c8c2f25.js"><link rel="prefetch" href="/vuepress-blog/assets/js/vendors~docsearch.b4d343ba.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/0.styles.8d2271d8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><div class="navbar-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-blog/" class="home-link router-link-active"><!----> <span class="site-name">My Blog</span></a> <div class="links" style="max-width:nullpx;"><nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuepress-blog/web/" class="nav-link">Web开发</a></div><div class="nav-item"><a href="/vuepress-blog/tool/" class="nav-link">工具使用</a></div><div class="nav-item"><a href="/vuepress-blog/tag/" class="nav-link">云标签</a></div> <!----></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></header></div> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuepress-blog/web/" class="nav-link">Web开发</a></div><div class="nav-item"><a href="/vuepress-blog/tool/" class="nav-link">工具使用</a></div><div class="nav-item"><a href="/vuepress-blog/tag/" class="nav-link">云标签</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>滑动选择器</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#如何滑动" class="sidebar-link">如何滑动</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#添加选择框" class="sidebar-link">添加选择框</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#添加事件" class="sidebar-link">添加事件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#修正位置" class="sidebar-link">修正位置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#类的方式实现" class="sidebar-link">类的方式实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#undefined" class="sidebar-link">dom 结构</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#undefined" class="sidebar-link">事件控制</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#undefined" class="sidebar-link">配置选项</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#undefined" class="sidebar-link">获取列表元素信息</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#undefined" class="sidebar-link">选择框</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#undefined" class="sidebar-link">获取元素位置和索引</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#undefined" class="sidebar-link">滑动</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#undefined" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/blog/web/%E6%BB%91%E5%8A%A8%E9%80%89%E6%8B%A9%E5%99%A8.html#undefined" class="sidebar-link">源码</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="article-list-inner" style="display:none;"><div class="tag-container"><div class="tag-item-container" style="display:none;"><span class="tag">
        html
      </span><span class="tag">
        工具使用
      </span><span class="tag">
        环境搭建
      </span><span class="tag">
        babel
      </span><span class="tag">
        总结
      </span><span class="tag">
        VuePress
      </span><span class="tag">
        图片下载
      </span><span class="tag">
        canvas
      </span><span class="tag">
        布局
      </span><span class="tag">
        js
      </span><span class="tag">
        模块
      </span><span class="tag">
        vue
      </span><span class="tag">
        echart
      </span><span class="tag">
        拖拽
      </span><span class="tag">
        moment
      </span><span class="tag">
        组件
      </span><span class="tag">
        css
      </span><span class="tag">
        移动端
      </span></div> <div class="tag-tip" style="display:none;">
      标签为
      <span></span>下的文章
    </div></div> <div></div></div> <div class="content__default"><h1 id="滑动选择器"><a href="#滑动选择器" class="header-anchor">#</a> 滑动选择器</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>要实现如以下的选择器，可以上下滑动，获取选择的值。</p> <p><img src="https://fireli-1256465711.cos.ap-chengdu.myqcloud.com/img/1584845677570.png" alt=""></p> <h2 id="如何滑动"><a href="#如何滑动" class="header-anchor">#</a> 如何滑动</h2> <p>最简单的方式就是将<code>列表</code>设置为超出隐藏，然后改变列表的<code>translateY</code>的值。</p> <h2 id="添加选择框"><a href="#添加选择框" class="header-anchor">#</a> 添加选择框</h2> <p><code>选择框</code> 是和<code>列表元素</code>同样大小，并且和列表同级，以<code>绝对定位</code>固定位置。如果是处于列表里面，因为列表是通过改变<code>translateY</code>滑动的，而<code>translateY</code>会影响<code>绝对定位</code>，那选择框的位置不可控。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list-contianer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 选择框和列表同级 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-select-box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>设置<code>slide-list-contianer</code>固定高度，和超出隐藏。</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.slide-list-contianer</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 160px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 160px<span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.slide-list li</span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>选择框和列表同级。</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.slide-list-contianer</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 160px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 64px<span class="token punctuation">;</span>
  <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid <span class="token function">rgb</span><span class="token punctuation">(</span>3<span class="token punctuation">,</span> 136<span class="token punctuation">,</span> 189<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid <span class="token function">rgb</span><span class="token punctuation">(</span>3<span class="token punctuation">,</span> 136<span class="token punctuation">,</span> 189<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>169<span class="token punctuation">,</span> 221<span class="token punctuation">,</span> 241<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0.4<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="添加事件"><a href="#添加事件" class="header-anchor">#</a> 添加事件</h2> <p>需要保证在选择框上滑动时，列表也会改变。所以只能在 <code>slide-list-contianer</code>上监听滑动事件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.slide-list-contianer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchstart&quot;</span><span class="token punctuation">,</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchmove&quot;</span><span class="token punctuation">,</span> move<span class="token punctuation">)</span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchend&quot;</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="修正位置"><a href="#修正位置" class="header-anchor">#</a> 修正位置</h2> <p>在滑动事件结束时（例如：<code>touchend</code>），可能 <code>选择框</code> 并不完全处于对应元素上：</p> <p><img src="https://fireli-1256465711.cos.ap-chengdu.myqcloud.com/img/1584845677572.png" alt=""></p> <p>需要在结束后，自动移动到最近的元素上。离选择框最近的元素也就是离顶线最近的元素。</p> <p>因为列表元素的高度是统一的，那么每个列表元素的位置也是固定的，假设元素的索引为<code>index</code>，单个元素的高度为<code>height</code>，列表的偏移距离为<code>translateY</code>，那么可以得到：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 离顶线最近元素</span>
<span class="token keyword">let</span> correctIndex <span class="token operator">=</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>translateY <span class="token operator">/</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 元素位置</span>
<span class="token keyword">let</span> correctTranslateY <span class="token operator">=</span> <span class="token operator">-</span>correctIndex <span class="token operator">*</span> height<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后改变<code>translateY</code>的值为<code>correctTranslateY</code>。</p> <p>注意，需要判断边界值，即边界情况为<code>最上面/最下面</code>元素处于选择框。</p> <h2 id="类的方式实现"><a href="#类的方式实现" class="header-anchor">#</a> 类的方式实现</h2> <h3 id="dom-结构"><a href="#dom-结构" class="header-anchor">#</a> dom 结构</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list-contianer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 如果没有，就是默认选择框 --&gt;</span>
  <span class="token comment">&lt;!-- &lt;div class=&quot;slide-select-box&quot;&gt;&lt;/div&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="事件控制"><a href="#事件控制" class="header-anchor">#</a> 事件控制</h3> <p>自定义事件控制器。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// on 监听的事件</span>
  onEvents <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// once:表示注册的事件只执行一次便自动移除</span>
  <span class="token function">on</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> once <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> name<span class="token punctuation">,</span>
      callback<span class="token operator">:</span> callback<span class="token punctuation">,</span>
      once<span class="token operator">:</span> once
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 移除事件</span>
  <span class="token function">off</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> event<span class="token punctuation">.</span>callback <span class="token operator">!==</span> callback
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">emit</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onEvents<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      event<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token operator">...</span>params<span class="token punctuation">)</span>
      <span class="token comment">// 事件执行完毕后，判断是否为一次性事件</span>
      <span class="token keyword">return</span> <span class="token operator">!</span>event<span class="token punctuation">.</span>once
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="配置选项"><a href="#配置选项" class="header-anchor">#</a> 配置选项</h3> <p>根据配置选项，将列表初始化为一个选择器。选项如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 可见行数</span>
  visiableRowCount<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token comment">// 初始位置索引</span>
  startIndex<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">// 保持索引位置不变</span>
  keepIndex<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 选择框</span>
  selectBox<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 选择框所在位置</span>
    position<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    style<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>详细阐述如图：</p> <p><img src="https://fireli-1256465711.cos.ap-chengdu.myqcloud.com/img/1584845677573.png" alt="enter description here"></p> <ul><li><code>visiableRowCount</code>：可见行数，超出的通过滑动出现。这里为 5。</li> <li><code>startIndex</code>：开始索引，最开始选择的元素索引。这里选择的是 2 号元素，<code>startIndex</code>为 2。</li> <li><code>keepIndex</code>：如果多次初始化选择器（执行<code>init</code>函数），保证所选元素索引不变。</li> <li><code>selectBox</code>: 选择框的配置
<ul><li><code>position</code>：选择框的位置，这里在第 2 号位置。</li> <li><code>style</code>：默认选择框的样式。</li></ul></li></ul> <h3 id="获取列表元素信息"><a href="#获取列表元素信息" class="header-anchor">#</a> 获取列表元素信息</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token function">setNodes</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.slide-list'</span><span class="token punctuation">)</span>

    <span class="token comment">// 每个元素大小相同</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// offsetWidth在元素隐藏时无效</span>
      width<span class="token operator">:</span> list<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>offsetWidth <span class="token operator">||</span> <span class="token number">30</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> list<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>offsetHeight <span class="token operator">||</span> <span class="token number">30</span><span class="token punctuation">,</span>
      total<span class="token operator">:</span> list<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list
    <span class="token keyword">this</span><span class="token punctuation">.</span>nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span>children<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="选择框"><a href="#选择框" class="header-anchor">#</a> 选择框</h3> <p>可以自定义选择框，通过添加一个类为<code>slide-select-box</code>的元素。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list-contianer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 如果没有，就是默认选择框 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slide-select-box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果没有则会启用默认选择框，可以在配置选项中更改默认选择框样式。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">addSelectBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 添加前，如果存在先remove掉</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectBox<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectBox<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo<span class="token punctuation">.</span>height
    <span class="token keyword">const</span> customSelectBox <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.slide-select-box'</span><span class="token punctuation">)</span>

    <span class="token comment">// 相对于父元素定位</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'relative'</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>customSelectBox<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      customSelectBox<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token comment">// 不改变原dom</span>
      <span class="token keyword">const</span> copy <span class="token operator">=</span> customSelectBox<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span>
      <span class="token comment">// 隐藏原dom</span>
      customSelectBox<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
      <span class="token keyword">const</span> computedStyle <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span>
        copy<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          top<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position <span class="token operator">*</span> height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
          position<span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
          width<span class="token operator">:</span> computedStyle<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
          height<span class="token operator">:</span> computedStyle<span class="token punctuation">.</span>height
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>selectBox <span class="token operator">=</span> copy
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 默认选择框</span>
    <span class="token keyword">const</span> selectBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span>selectBox<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      width<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span>offsetWidth <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
      position<span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
      left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      top<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position <span class="token operator">*</span> height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
      borderTop<span class="token operator">:</span> <span class="token string">'1px solid rgb(3, 136, 189)'</span><span class="token punctuation">,</span>
      borderBottom<span class="token operator">:</span> <span class="token string">'1px solid rgb(3, 136, 189)'</span><span class="token punctuation">,</span>
      background<span class="token operator">:</span> <span class="token string">'rgb(169, 221, 241)'</span><span class="token punctuation">,</span>
      opacity<span class="token operator">:</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>style
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>selectBox<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>selectBox <span class="token operator">=</span> selectBox
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="获取元素位置和索引"><a href="#获取元素位置和索引" class="header-anchor">#</a> 获取元素位置和索引</h3> <p>在修正位置或是获取当前选择的的元素等情况下，需要用到以下方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token comment">// 获取正确的元素位置</span>
  <span class="token function">getCorrectPos</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> correctIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTopIndex</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>translateY<span class="token punctuation">)</span>
    <span class="token keyword">const</span> correctTranslateY <span class="token operator">=</span> <span class="token operator">-</span>correctIndex <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo<span class="token punctuation">.</span>height

    <span class="token keyword">return</span> correctTranslateY
  <span class="token punctuation">}</span>

  <span class="token comment">// 根据translateY获得最近顶部元素索引</span>
  <span class="token function">getTopIndex</span> <span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> topIndex <span class="token operator">=</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>y <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
    <span class="token comment">// 顶端元素在选择框内时，无法再下滑动</span>
    <span class="token keyword">const</span> minTopIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position
    <span class="token keyword">const</span> maxTopIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo<span class="token punctuation">.</span>total <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position

    <span class="token keyword">if</span> <span class="token punctuation">(</span>topIndex <span class="token operator">&lt;</span> minTopIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      topIndex <span class="token operator">=</span> minTopIndex
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>topIndex <span class="token operator">&gt;</span> maxTopIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      topIndex <span class="token operator">=</span> maxTopIndex
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> topIndex
  <span class="token punctuation">}</span>

  <span class="token comment">// 根据translateY获取所选元素索引</span>
  <span class="token function">getSelectedIndex</span> <span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTopIndex</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position
  <span class="token punctuation">}</span>

  <span class="token comment">// 获取所选元素位置</span>
  <span class="token function">getSelectedPos</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">-</span>index <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>selectBox<span class="token punctuation">.</span>position<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeInfo<span class="token punctuation">.</span>height
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="滑动"><a href="#滑动" class="header-anchor">#</a> 滑动</h3> <p>滑动就是不断设置元素<code>translateY</code>值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token function">setPos</span> <span class="token punctuation">(</span><span class="token parameter">dy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>translateY <span class="token operator">+=</span> dy
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      transform<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>translateY<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 在滑动过程中实时获得下一个元素索引</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCurIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>
      <span class="token string">'slide'</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>nodes
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">setCurIndex</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>curIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSelectedIndex</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>translateY<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastIndex <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addSelectedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>
        <span class="token string">'change'</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nodes
      <span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>curIndex
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">addSelectedClass</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> curItem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>curIndex<span class="token punctuation">]</span>
    <span class="token keyword">const</span> lastItem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastIndex<span class="token punctuation">]</span>

    curItem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'slide-item-checked'</span><span class="token punctuation">)</span>
    lastItem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'slide-item-checked'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>在滑动过程中，需要设置当前所选元素索引，分发<code>slide</code>和<code>change</code>事件，并为所选元素添加<code>slide-item-checked</code>事件。</p> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.slide-list-contianer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> slide <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Slide</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// 可见行数</span>
  visiableRowCount<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token comment">// 初始位置索引</span>
  startIndex<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">// 保持索引位置不变</span>
  keepIndex<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 选择框</span>
  selectBox<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 选择框所在位置</span>
    position<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    style<span class="token operator">:</span> <span class="token punctuation">{</span>
      background<span class="token operator">:</span> <span class="token string">&quot;red&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slide<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> nodes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
slide<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="源码"><a href="#源码" class="header-anchor">#</a> 源码</h3> <p>源码和更多使用请看：</p></div> <div class="sidebar-right"><div class="sidebar-right-inner"><div class="newest"><div class="title">推荐阅读</div> <ol class="title-list"></ol></div> <div class="about"><div class="title">云标签</div> <div class="title-list"><span class="tag">
            html
          </span><span class="tag">
            工具使用
          </span><span class="tag">
            环境搭建
          </span><span class="tag">
            babel
          </span><span class="tag">
            总结
          </span><span class="tag">
            VuePress
          </span><span class="tag">
            图片下载
          </span><span class="tag">
            canvas
          </span><span class="tag">
            布局
          </span><span class="tag">
            js
          </span><span class="tag">
            模块
          </span><span class="tag">
            vue
          </span><span class="tag">
            echart
          </span><span class="tag">
            拖拽
          </span><span class="tag">
            moment
          </span><span class="tag">
            组件
          </span><span class="tag">
            css
          </span><span class="tag">
            移动端
          </span></div></div> <div class="catalog"><div class="title">目录</div> <div class="article-title"><h3>滑动选择器</h3></div> <div class="title-list"><ul class="catalog-level-1"><li><span>前言</span> <!----></li><li><span>如何滑动</span> <!----></li><li><span>添加选择框</span> <!----></li><li><span>添加事件</span> <!----></li><li><span>修正位置</span> <!----></li><li><span>类的方式实现</span> <ul class="catalog-level-2"><li><span>dom 结构</span></li><li><span>事件控制</span></li><li><span>配置选项</span></li><li><span>获取列表元素信息</span></li><li><span>选择框</span></li><li><span>获取元素位置和索引</span></li><li><span>滑动</span></li><li><span>使用</span></li><li><span>源码</span></li></ul></li></ul></div></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/vuepress-blog/assets/js/app.f68b45ad.js" defer></script><script src="/vuepress-blog/assets/js/24.502f4dcd.js" defer></script>
  </body>
</html>
